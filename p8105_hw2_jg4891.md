p8105_hw2_jg4891
================
2025-09-24

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.2
    ## ✔ ggplot2   4.0.0     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
options(tibble.print_min = 5)
```

## Problem 1

``` r
pols_df <- read_csv("fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day"), sep = '-') %>%
  mutate(
    year  = as.character(year),
    month = as.integer(month),       # "01" -> 1, "02" -> 2
    month = month.name[month],       # full month names
    month = as.character(month),
    president = case_when(
      prez_gop == 1 ~ "Republican",
      prez_dem == 1 ~ "Democratic"
    )
  ) %>%
  select(-prez_gop, -prez_dem, -day)
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp_df <- read_csv("fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>%
  separate(date, into = c("month", "day", "year"), sep = '/') %>%
  mutate(
    month = as.integer(month),
    year  = as.integer(year),
    year  = ifelse(year < 50, 2000 + year, 1900 + year),
    month = month.name[month],     # full month names
    year  = as.character(year),
    month = as.character(month)
  ) %>%
  select(-day) %>%
  select(year, month, everything())
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
unemploy_df <- read_csv("fivethirtyeight_datasets/unemployment.csv") %>% 
janitor::clean_names() %>% 
pivot_longer(
    cols = jan:dec,                  # columns to pivot
    names_to = "month",              # new column with month names
    values_to = "unemployment_percent" # new column with values
  ) %>% 
  
  mutate(
    month = month.name[match(tolower(month), tolower(month.abb))],
    month = factor(month, levels = month.name, ordered = TRUE),
    year  = as.character(year),
    month = as.character(month)
  )
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
ft_df = left_join(pols_df, snp_df, by = c("year", "month"))
Sd_df = left_join(ft_df, unemploy_df, by = c("year", "month"))
print(Sd_df)
```

    ## # A tibble: 822 × 11
    ##   year  month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##   <chr> <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ## 1 1947  January       23      51     253      23      45     198 Democrat…    NA
    ## 2 1947  February      23      51     253      23      45     198 Democrat…    NA
    ## 3 1947  March         23      51     253      23      45     198 Democrat…    NA
    ## 4 1947  April         23      51     253      23      45     198 Democrat…    NA
    ## 5 1947  May           23      51     253      23      45     198 Democrat…    NA
    ## # ℹ 817 more rows
    ## # ℹ 1 more variable: unemployment_percent <dbl>

Pols_df dataset contains the number of national politicians who are
democratic or republican at any given time from 1947 Jan to 2015 June.
Snp_df dataset includes closing values of the S&P stock index from 1950
Jan to 2015 July. Unemploy_df dataset includes unemployment percentages
from 1948 Jan to 2015 Dec.  This merged dataset reflects number of
republican governors and senators, democratic governors and senators,
and president’s party, and unemployment percentage from 1947 to 2015.

## Problem 2

``` r
  mr_df = 
  readxl::read_excel("Trash.xlsx", sheet="Mr. Trash Wheel", range = "A2:N653",na = c("NA", "", "."))|>
  filter(!is.na(Dumpster)) |> 
  janitor::clean_names() |> 
  mutate(sheet = "Mr. Trash") |> 
  mutate(sports_balls = as.integer(round(sports_balls)))
```

``` r
  pr_df = 
  readxl::read_excel("Trash.xlsx", sheet="Professor Trash Wheel", range = "A2:M120",na = c("NA", "", "."))|>
  filter(!is.na(Dumpster)) |> 
  janitor::clean_names() |> 
  mutate(sheet = "Professor Trash")
```

``` r
  gw_df = 
  readxl::read_excel("Trash.xlsx", sheet="Gwynnda Trash Wheel", range = "A2:L265",na = c("NA", "", "."))|>
   filter(!is.na(Dumpster)) |> 
  janitor::clean_names() |> 
  mutate(sheet = "Gwynnda Trash")
```

``` r
df_tidy = bind_rows(gw_df %>% mutate(year = as.numeric(year)), mr_df%>% mutate(year = as.numeric(year)), pr_df%>% mutate(year = as.numeric(year))) |> 
  janitor::clean_names() |> 
  select(sheet, everything())


pf_wt <- df_tidy %>% 
  filter(sheet == "Professor Trash") %>% 
  summarize(total_weight = sum(weight_tons, na.rm = TRUE)) %>% 
  pull(total_weight)

gw_cb <- df_tidy %>% 
  filter(sheet == "Gwynnda Trash", year=="2022", month=="June") %>% 
  summarize(total_weight = sum(cigarette_butts, na.rm = TRUE)) %>% 
  pull(total_weight)
```

Variables definition: Dumpster shows the code for each dumpster in
numeric value. Sheet is the dataset that each dumpster belong to, such
as Mr. Trash, Professor Trash or Gynnda Trash. Weight_tons is the
weight(tons) for each dumpster. Plastic bottles shows up the number of
plastic bottles in each dumpster. Homes_powered is the energy that trash
generate for home.

In total, we have 1032 observations. In Professor Trash Wheel dataset,
we have total weight of trash of 246.74 tons. In Gwynnda dataset, in
June 2022, we have a total number of cigarette butts collected is
1.812^{4}.

## Problem 3

``` r
z1_df = read_csv("zillow_data/Zip_NYC.csv", na = c("NA", "", ".")) |> 
  janitor::clean_names() |> 
  rename(zip_code=region_name) 
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
z1_df2 =
  pivot_longer(z1_df,
    x2015_01_31:x2024_08_31,
    names_to = "time", 
    values_to = "Index") 

z2_df <- read_csv("zillow_data/Zipcodes.csv",na = c("NA", "", ".")) |> 
  janitor::clean_names() 
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
m2_df = left_join(z1_df2, z2_df, by="zip_code") |> 
  filter(!is.na(Index)) |> 
  select(-region_type,-state_name,-county_name) |> 
  relocate(time, size_rank, Index,  state, state_fips,  city, zip_code, county, county_fips, county_code, region_id, metro, neighborhood, file_date)
```

    ## Warning in left_join(z1_df2, z2_df, by = "zip_code"): Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 4757 of `x` matches multiple rows in `y`.
    ## ℹ Row 256 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.
